<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    
    <title>Khadas VIM2/VIM3/Edge KBI说明 | Hexo</title>
    
    
        <meta property="og:site_name" content="Hexo">
    
    
        <meta property="article:author" content="John Doe">
    
    
        <link rel="icon" href="/img/favicon.ico">
    
    
<link rel="stylesheet" href="/css/minireset.min.css">

    
<link rel="stylesheet" href="/css/all.min.css">

    
<link rel="stylesheet" href="/css/csshake.min.css">

    
<link rel="stylesheet" href="/css/hljs/lioshi.css">

    
<link rel="stylesheet" href="/css/jquery.fancybox.min.css">

    
<link rel="stylesheet" href="/styl/main.css">

    
<script src="/js/jquery.min.js"></script>

    
<script src="/js/highlight.min.js"></script>

    
<script src="/js/jquery.fancybox.min.js"></script>

    
<script src="/js/clipboard.min.js"></script>

<meta name="generator" content="Hexo 5.4.0"></head>
<body>
    <header>
  <div class="outer">
    <div class="inner">
      <h1 class="logo-wrap">
        <a>Hexo<b><sup>1.1</sup></b></a>
      </h1>
    </div>
    <div class="inner">
      <nav class="main-nav">
        
          <a href="/">首页</a>
        
          <a href="/archives">归档</a>
        
          <a href="/categories">分类</a>
        
          <a href="/tags">标签</a>
        
          <a href="/friends">友链</a>
        
          <a href="/about">关于</a>
        
          <a target="_blank" rel="noopener" href="https://www.baidu.com">百度</a>
        
      </nav>
    </div>
  </div>
</header>
    <div class="content">
        <section class="outer">
    <article>
        <div class="article-title">
    <h2>
        <a href="/2021/03/30/LinuxRelease/KhadasVim3/vim3/KbiGuidance/" class="shake shake-little" title="Khadas VIM2/VIM3/Edge KBI说明">
            
            Khadas VIM2/VIM3/Edge KBI说明
        </a>
    </h2>
    <div class="meta_box">
    
        
        
            
                
        
        <div class="meta meta_auth">
            <img src="/img/default.png" alt="head" />
            <p>anonymous</p>
        </div>
    
        
        
        <div class="meta meta_date">
            <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
            <p>发布于：2021年03月30日</p>
        </div>
    
        <div class="meta meta_update">
            <i class="fas fa-edit fa-fw" aria-hidden="true"></i>
            <p>更新于：2021年03月30日</p>
        </div>
    </div>
    

</div>

        <hr>
        <div class="article-entry">
            
            
            
            <p>KBI是”Khadas Bootloader Instructions”的缩写，主要用于以下几方面：</p>
<ul>
<li>控制可编程MCU</li>
<li>管理底层硬件</li>
<li>让开发者体验VIM2/VIM3/Edge全部的特性</li>
</ul>
<p>这篇文档介绍了如何配置使用KBI。 因为KBI是<a target="_blank" rel="noopener" href="http://www.denx.de/">U-Boot</a> 命令，所以必须先设置串口调试工具(<a href="/vim3/SetupSerialTool.html">VIM2</a>/<a href="/vim3/SetupSerialTool.html">VIM3</a>/<a href="/edge/SetupSerialTool.html">Edge</a>)。</p>
<p><em>注意：此文档以VIM2为例进行说明，VIM3和Edge都是差不多的用法。</em></p>
<p>在开始之前，确保先进入U-boot命令行模式:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">normal power off</span><br><span class="line">boot wol: enable</span><br><span class="line">Hit Enter or space or Ctrl+C key to stop autoboot -- :  0 </span><br><span class="line">kvim2#</span><br></pre></td></tr></table></figure>

<h3 id="帮助信息"><a href="#帮助信息" class="headerlink" title="帮助信息"></a>帮助信息</h3><p>和其他U-boot命令一样，直接执行<code>kbi</code>会给出帮助信息：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi</span><br><span class="line">kbi - Khadas Bootloader Instructions sub-system</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">kbi [function] [mode] [write|read] &lt;value&gt;</span><br><span class="line"></span><br><span class="line">kbi version - read version information</span><br><span class="line">kbi usid - read usid information</span><br><span class="line">kbi adc - read adc value</span><br><span class="line">kbi powerstate - read power on state</span><br><span class="line">kbi poweroff - power off device</span><br><span class="line">kbi ethmac - read ethernet mac address</span><br><span class="line"></span><br><span class="line">kbi led [systemoff|systemon] w &lt;off|on|breathe|heartbeat&gt; - set blue led mode</span><br><span class="line">kbi led [systemoff|systemon] r - read blue led mode</span><br><span class="line"></span><br><span class="line">kbi bootmode w &lt;emmc|spi&gt; - set bootmode to emmc or spi</span><br><span class="line">kbi bootmode r - read current bootmode</span><br><span class="line"></span><br><span class="line">kbi trigger [wol|rtc|ir|dcin|key|gpio] w &lt;0|1&gt; - disable&#x2F;enable boot trigger</span><br><span class="line">kbi trigger [wol|rtc|ir|dcin|key|gpio] r - read mode of a boot trigger</span><br></pre></td></tr></table></figure>

<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><p><strong>1) 获取MCU固件版本号：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi version</span><br><span class="line">version: 03</span><br></pre></td></tr></table></figure>

<p><strong>2) 初始化KBI：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi init</span><br></pre></td></tr></table></figure>

<p><strong>3) 获取设备usid：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi usid</span><br><span class="line">usid: 000000</span><br></pre></td></tr></table></figure>

<p><strong>4) 获取ADC数值：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi adc</span><br><span class="line">adc: 0x236</span><br></pre></td></tr></table></figure>
<p><em>ADC数值用于区分不同的Khadas开发板。</em></p>
<p><strong>5) 给设备断电：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi poweroff</span><br></pre></td></tr></table></figure>

<p><strong>6) 获取以太网MAC地址：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi ethmac</span><br><span class="line">mac address: 98:aa:fc:60:44:c0</span><br></pre></td></tr></table></figure>

<p><strong>7) 设置LED工作模式：</strong><br>VIM2蓝色LED有不同的工作模式，如<code>长灭</code>、<code>长亮</code>、<code>呼吸</code>和<code>心跳</code>等来只是不同的状态。</p>
<p>VIM2 蓝色LED是由MCU来控制的，同时MCU还控制VIM2的总电源，而VIM2白色LED是由Amlogic CPU来控制的，所以蓝色LED会一直工作，即使你关闭了VIM2电源。</p>
<p>事实上，KBI能设置两种不同的蓝灯模式：</p>
<ul>
<li>系统关闭/待机：断电状态，CPU断电。</li>
<li>系统运行/工作：上电状态，CPU工作。</li>
</ul>
<p>示例：</p>
<p>查看系统关闭/待机时的蓝灯模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi led systemoff r</span><br><span class="line">led mode: breathe  [systemoff]</span><br></pre></td></tr></table></figure>

<p>查看系统运行/工作时的蓝灯模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi led systemon r</span><br><span class="line">led mode: off  [systemon]</span><br></pre></td></tr></table></figure>

<p>上面显示当系统运行时蓝灯状态为<code>长灭</code>，你可以改为<code>呼吸灯</code>模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi led systemon w breathe</span><br></pre></td></tr></table></figure>

<p>同样的，对于系统关闭时的蓝灯状态，你也可以设置为别的模式，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi led systemon w breathe</span><br></pre></td></tr></table></figure>

<p><strong>8) 启动模式</strong><br>VIM2配置有eMMC和SPI存储器，可以通过KBI设置从哪里启动系统。</p>
<p>设置默认从SPI Flash启动系统：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi bootmode w spi</span><br></pre></td></tr></table></figure>
<p>*关于SPI FLASH启动请参考如何从SPI Flash启动(<a target="_blank" rel="noopener" href="http://forum.khadas.com/t/how-to-boot-from-spi-flash/1354">VIM2</a>/<a href="/vim3/BootFromSpiFlash.html">VIM3</a>/<a href="/edge/BootFromSpiFlash.html">Edge</a>)*。</p>
<p>设置默认从eMMC启动系统：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi bootmode w emmc</span><br></pre></td></tr></table></figure>

<p>查看当前启动模式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi bootmode r</span><br><span class="line">bootmode: emmc</span><br></pre></td></tr></table></figure>

<p><strong>9) 开机触发事件</strong><br>VIM2支持不同的开机触发事件：</p>
<ul>
<li>WOL: 通过网络唤醒开机</li>
<li>RTC: 通过RTC唤醒开机</li>
<li>IR: 通过红外唤醒开机</li>
<li>DCIN: 通过DC输入唤醒开机</li>
<li>Key: 通过电源键唤醒开机</li>
<li>GPIO: 通过外部GPIO唤醒开机</li>
</ul>
<p>这意味着，当VIM2关机时，上述任意一个事件在使能的情况下可以触发VIM2开机。</p>
<p>示例：</p>
<p>获取WOL触发使能状态：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi trigger wol r</span><br><span class="line">boot wol: disable</span><br></pre></td></tr></table></figure>

<p>出厂固件WOL是默认关闭的。你可以通过如下方式打开WOL触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi trigger wol w 1</span><br><span class="line">set_wol: 1</span><br></pre></td></tr></table></figure>

<p>当然，出于安全的角度考虑，你可能需要关闭WOL触发：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kvim2# kbi trigger wol w 0</span><br><span class="line">set_wol: 0</span><br></pre></td></tr></table></figure>

<h3 id="更多"><a href="#更多" class="headerlink" title="更多"></a>更多</h3><p><a href="/vim2/HowtoUseWol.html">如何使用WOL</a>。<br><a target="_blank" rel="noopener" href="https://dl.khadas.com/Hardware/Edge/MCU/Edge-V_MCU_REG_ZH.pdf">Edge-V MCU寄存器说明</a><br><a target="_blank" rel="noopener" href="https://dl.khadas.com/Hardware/VIM2/MCU/VIM2_MCU_REG_ZH.pdf">VIM2 MCU寄存器说明</a><br><a target="_blank" rel="noopener" href="https://dl.khadas.com/Hardware/VIM3/MCU/VIM3_MCU_REG_ZH.pdf">VIM3 MCU寄存器说明</a></p>

        </div>
        <div class="article-copyright">
            
    <blockquote>
        <p>
            版权声明：本文为「河东小伍」的原创文章，博客内容遵循 署名-非商业性使用-相同方式共享 协议。<br>本文永久链接是：http://example.com/2021/03/30/LinuxRelease/KhadasVim3/vim3/KbiGuidance/
        </p>
    </blockquote>


        </div>
    </article>
    

    <section id="toc-div" >
        <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%AE%E5%8A%A9%E4%BF%A1%E6%81%AF"><span class="toc-text">帮助信息</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="toc-text">使用方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9B%B4%E5%A4%9A"><span class="toc-text">更多</span></a></li></ol>
    </section>
    <section id="gohome" style="display: none;"><a>顶</a></section>

    <script>
        function get_top_by_link(link){
            var hnid = "#" + $(link).attr("data");
            if ($(hnid).length > 0){
                return $(hnid).offset().top;
            }else{
                return 0;
            }
        }
        //go to hn
        function gotohn(link){
            $("html,body").animate({scrollTop: get_top_by_link(link) }, 300);
        }
        //页面滚动
        function update(){
            var scrollH = $(window).scrollTop();
            if($(".toc-link")){
                $(".toc-link").each(function(i,link){
                    var mdHeight = get_top_by_link(link);
                    if(mdHeight <= scrollH + 40){
                        //高亮导航菜单
                        $('.toc-link').removeClass('on');
                        $(link).addClass('on');
                    }
                });
            }
            //返回顶部显隐
            if(scrollH < 200){
                $("#gohome").css("display","none");
            }else{
                $("#gohome").css("display","block");
            }
        }
        $(function(){
            //修复部分锚点从属关系
            if($("#toc-div >li").length > 0){
                $("#toc-div >li").appendTo($("#toc-div >ol:first"));
            }
            //返回顶部
            $('#gohome').click(function(){
                $("html,body").animate({scrollTop: 0}, 300);
                return false;
            })
            //遍历锚点
            $(".toc-link").each(function(i,link){
                $(link).attr("data",$(link).attr('href').substring(1));
                $(link).attr("href","javascript:void(0);");
                $(link).attr("onclick","gotohn(this);");
            })
            //绑定滚动事件
            $(window).bind('scroll', update);
            //初始化toc
            var first_toc = $(".toc-link")[0];
            var first_scroll = get_top_by_link(first_toc);
            var window_scroll = $(window).scrollTop();
            if(window_scroll <= first_scroll){
                $(first_toc).addClass('on');
            }
        })
    </script>

</section>
    </div>
    <footer>
    <div class="outer">
        <div class="inner">
            Powered by <a href="http://prowiki.demopage.icu/" target="_blank">ProWiki</a>
            &copy;2021 BW<br>
            <a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">冀ICP备00000000号</a>
        </div>
    </div>
</footer>

<script src="/js/custom.js"></script>


    <script>onload_content();</script>

</body>
</html>
